<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keen Islamic Public School</title>
    
    <!-- React & Tailwind Setup -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Firebase SDKs (Compat version for HTML usage) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        // --- 1. FIREBASE SETUP (YAHAN APNI SETTINGS DALEN) ---
        const firebaseConfig = {
            // Yahan Firebase Console se copy kiya hua code paste karein
            // Example:
            // apiKey: "AIzaSyDummyKey...",
            // authDomain: "your-app.firebaseapp.com",
            // projectId: "your-app",
            // storageBucket: "your-app.appspot.com",
            // messagingSenderId: "123456",
            // appId: "1:12345:web:abcdef"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.firestore();
        const appId = 'default-school-app';

        // --- ICONS WRAPPER (Lucide React nahi chalta direct HTML me, isliye Lucide global use karenge) ---
        const Icon = ({ name, size = 20, className }) => {
            React.useEffect(() => {
                lucide.createIcons();
            }, []);
            return <i data-lucide={name} className={className} style={{ width: size, height: size }}></i>;
        };

        // --- COMPONENTS ---

        // Helper Hook for School Assets
        const useSchoolAssets = () => {
            const [assets, setAssets] = React.useState({ 
                logo: "https://cdn-icons-png.flaticon.com/512/3609/3609741.png", 
                background: "https://images.unsplash.com/photo-1523050854058-8df90110c9f1?q=80&w=2070&auto=format&fit=crop", 
                name: 'Keen Islamic Public School' 
            });
            
            React.useEffect(() => {
                const logoRef = db.doc(`artifacts/${appId}/public/data/assets/logo`);
                const unsubLogo = logoRef.onSnapshot((snap) => {
                    if (snap.exists && snap.data().image) {
                        setAssets(prev => ({ ...prev, logo: snap.data().image }));
                    }
                });
                return () => unsubLogo();
            }, []);
            return assets;
        };

        const Card = ({ children, className = "" }) => (
            <div className={`bg-white/90 backdrop-blur-sm rounded-xl shadow-sm border border-slate-100 p-6 ${className}`}>
                {children}
            </div>
        );

        const Header = ({ user, onLogout }) => {
            const { logo, name } = useSchoolAssets();
            return (
                <header className="bg-white/90 backdrop-blur-md border-b border-slate-200 sticky top-0 z-30 print:hidden">
                    <div className="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
                        <div className="flex items-center gap-3">
                            <div className="bg-slate-900 p-1 rounded-lg flex items-center justify-center w-10 h-10 border-2 border-slate-100 shadow-sm">
                                <img src={logo} alt="School Logo" className="w-full h-full object-contain" />
                            </div>
                            <div>
                                <h1 className="font-bold text-slate-800 text-lg leading-tight hidden md:block">{name}</h1>
                                <h1 className="font-bold text-slate-800 text-lg leading-tight md:hidden">KIPS</h1>
                            </div>
                        </div>
                        <div className="flex items-center gap-4">
                            <div className="text-right hidden sm:block">
                                <p className="text-sm font-semibold text-slate-900">{user.name}</p>
                                <p className="text-xs text-slate-500 capitalize">{user.role}</p>
                            </div>
                            <button onClick={onLogout} className="p-2 text-slate-400 hover:text-rose-600">
                                <Icon name="log-out" />
                            </button>
                        </div>
                    </div>
                </header>
            );
        };

        const Footer = () => (
            <div className="text-center py-6 text-xs font-medium text-slate-400">
                Created by Subhan Mughal
            </div>
        );

        // --- LOGIN COMPONENT ---
        const Login = ({ onLogin }) => {
            const [userId, setUserId] = React.useState('admin1');
            const [password, setPassword] = React.useState('123');
            const [error, setError] = React.useState('');
            const [loading, setLoading] = React.useState(false);
            const { logo, background, name } = useSchoolAssets();

            const handleLogin = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError('');
                const cleanId = userId.trim();

                try {
                    const userDoc = await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('users').doc(cleanId).get();
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        if (userData.password === password) {
                            onLogin({ ...userData, id: userDoc.id });
                        } else {
                            setError('Invalid Password');
                        }
                    } else {
                         // Auto Seed for Demo if first time
                        if ((cleanId === 'admin1' && password === '123') || (cleanId === 'ghazanfar74' && password === '413457')) {
                            await seedDatabase();
                            alert("Database Initialized! Please click Login again.");
                        } else {
                            setError('User ID not found');
                        }
                    }
                } catch (err) {
                    console.error(err);
                    setError('Database Connection Error. Check Config.');
                }
                setLoading(false);
            };

            return (
                <div className="min-h-screen flex bg-slate-50 relative">
                    <div className="absolute inset-0 z-0 bg-cover bg-center" style={{ backgroundImage: `url(${background})` }} />
                    <div className="absolute inset-0 z-0 bg-slate-900/60 backdrop-blur-[2px]" />
                    
                    <div className="hidden lg:flex w-1/2 relative z-10 flex-col justify-between p-12">
                        <div className="relative z-10">
                            <div className="flex items-center gap-4 mb-6">
                                <img src={logo} className="w-20 h-20 object-contain bg-white/90 rounded-2xl p-2" />
                                <div>
                                    <span className="text-white font-black text-5xl block">KIPS</span>
                                    <span className="text-amber-300 font-medium text-lg">PORTAL</span>
                                </div>
                            </div>
                            <h1 className="text-6xl font-bold text-white mb-6">Excellence in <br/><span className="text-amber-400">Education</span></h1>
                        </div>
                        <div className="text-slate-300 text-sm">Created by Subhan Mughal</div>
                    </div>

                    <div className="w-full lg:w-1/2 flex items-center justify-center p-6 relative z-10">
                        <div className="bg-white/95 backdrop-blur-md p-8 rounded-3xl shadow-2xl border border-white/50 w-full max-w-md">
                            <h2 className="text-2xl font-bold text-slate-900 mb-2">Welcome Back</h2>
                            <p className="text-slate-500 mb-8">Login to continue</p>
                            {error && <div className="bg-rose-50 text-rose-600 px-4 py-3 rounded-lg mb-6 text-sm">{error}</div>}
                            <form onSubmit={handleLogin} className="space-y-5">
                                <input type="text" value={userId} onChange={(e) => setUserId(e.target.value)} className="w-full px-4 py-3 rounded-lg border" placeholder="User ID" />
                                <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} className="w-full px-4 py-3 rounded-lg border" placeholder="Password" />
                                <button type="submit" disabled={loading} className="w-full bg-slate-900 text-white py-3.5 rounded-lg font-bold hover:bg-slate-800">{loading ? 'Checking...' : 'Sign In'}</button>
                            </form>
                        </div>
                    </div>
                </div>
            );
        };

        // --- SEED DATABASE FUNCTION ---
        const seedDatabase = async () => {
             const batch = db.batch();
             const usersRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('users');
             
             const users = [
                 { id: 'admin1', data: { username: 'admin1', password: '123', role: 'admin', name: 'Principal Sir', classId: null } },
                 { id: 'ghazanfar74', data: { username: 'ghazanfar74', password: '413457', role: 'admin', name: 'Admin Ghazanfar', classId: null } },
                 { id: 'teacher2', data: { username: 'teacher2', password: '123', role: 'teacher', name: 'Ms. Ayesha', classId: '2' } },
                 { id: 'student1', data: { username: 'student1', password: '123', role: 'student', name: 'Ali Ahmed', classId: '2', feeStatus: 'paid', rollNo: '101' } }
             ];

             users.forEach(u => {
                 batch.set(usersRef.doc(u.id), u.data);
             });
             
             await batch.commit();
        };

        // --- MAIN APP COMPONENT ---
        const App = () => {
            const [user, setUser] = React.useState(null);
            const [loading, setLoading] = React.useState(true);

            React.useEffect(() => {
                // Anonymous auth just to connect to Firebase
                auth.signInAnonymously().then(() => setLoading(false)).catch(e => console.error(e));
            }, []);

            if (loading) return <div className="min-h-screen flex items-center justify-center">Loading...</div>;
            if (!user) return <Login onLogin={setUser} />;

            return (
                <div className="min-h-screen bg-slate-50 flex flex-col">
                    <Header user={user} onLogout={() => setUser(null)} />
                    <main className="flex-1 p-4">
                        <div className="max-w-4xl mx-auto text-center py-20">
                            <h2 className="text-3xl font-bold text-slate-800">Welcome, {user.name}</h2>
                            <p className="text-slate-500 mt-2">You are logged in as {user.role}.</p>
                            <p className="text-sm text-slate-400 mt-8">(Full dashboard features available when connected to real Firebase)</p>
                        </div>
                    </main>
                    <Footer />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>